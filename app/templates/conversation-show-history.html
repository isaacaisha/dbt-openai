{% extends 'header.html' %}

{% block title %} Welcom€ to{% endblock %}

{% block head %}
    {{ super() }}
    <link rel="shortcut icon" type="image/x-icon" href="{{ url_for('static', filename='assets/images/favicon1.ico') }}">
    {% include 'bootstrap/base.html' %}
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
{% endblock %}

{% block content1 %}
<div class="container-fluid">
    <div class="p-1 rounded-3 jumbotron">
        <div class="container-fluid py-1">
            <h1 class="">Recent Conversation History ¡!¡</h1>
        </div>
    </div>
</div>
{% endblock %}

{% block content %}
{% autoescape true %}

    <div class="content container">

        <hr class="mb-3" style="color:green;">
        <h3 class="text-center conversations-details" style="margin-top:0;">Recent Conversation</h3>
        <hr class="mb-3" style="color:green;">

        <div class="text-center">
            {% if search_message %}
                <div class="alert alert-danger mb-5">{{ search_message }}</div>
            {% endif %}

            {% if not memory_load %}
                {% if error_message %}
                    <div class="alert alert-info mb-5">
                        {{ error_message }}
                    </div>
                {% endif %}

            {% else %}
                <div class="d-flex justify-content-center mb-5">
                    <button class="btn btn-outline-info submit scroll-down " onclick="scrollDown()" id="scrollDownButton"
                        style="position:fixed">
                        ⇩
                    </button>
                </div>
                
                <form action="{{ url_for('llm_conversation.show_story') }}" method="GET" class="text-center">
                    <div class="form-group">
                        <label for="limit" class="form-label label_">Enter the <span style="color:#f3f030;">number</span> of
                            conversations <span style="color:#f3f030;">you want to retrieve</span>:</label>
                        <div class="input-group">
                            <input type="number" id="limit" name="limit" min="1" max="9991" class="form-control form-control-sm mb-3">
                        </div>
                        <label for="offset" class="form-label label_">Enter the <span style="color:#f3f030;">number</span> of
                            conversations <span style="color:#f3f030;">you want to skip</span>:</label>
                        <div class="input-group">
                            <input type="number" id="offset" name="offset" min="1" class="form-control form-control-sm mb-3">
                        </div>
                        <label for="search" class="form-label label_">Enter a <span style="color:#f3f030;">word</span> <span
                                style="color:#fff;">from {{ current_user.name }}</span> conversations <span style="color:#f3f030;">to
                                retrieve it</span>:</label>
                        <div class="input-group">
                            <input type="string" id="search" name="search" class="form-control form-control-sm mb-3">
                            <!-- Single submit button -->
                            <button class="btn btn-outline-info mb-3" type="submit" onclick="setFormAction('get_all_conversations')"
                                style="border: .1rem solid;">Submit</button>
                        </div>
                    </div>
                </form>

                <div id="resultMemo" class="text-center mb-3">
                    <hr class="mb-3" style="color:yellow;">
                
                    <h3 style="margin-top:0; color:#17a2b8;">Memory Load</h3>
                    <textarea class="textarea-memory mb-3" style="color:#9ED2C6;">
                    {% if memory_load %}
                        {% for memory in memory_load %}
                            {{ memory.user_name }}:
                        {{ memory.user_message }}
                            ·SìįSí·Dbt·:
                        {{ memory.llm_response }}
                        {% endfor %}
                    {% else %}
                        No Data Available. First Interact With ·SìįSí·Dbt·
                    {% endif %}
                    </textarea>
                
                    <hr class="mb-5" style="color:yellow;">
                    <hr class="mb-3" style="color:red;">
                
                    <h3 style="margin-top:0; color:#17a2b8;">Summary</h3>
                    <textarea class="textarea-memory mb-3" style="color:#AEFAFC;">{{ summary_conversation|safe }}</textarea>
                
                    <hr class="mb-5" style="color:red;">
                    <hr class="mb-3" style="color:green;">
                
                    <h3 style="margin-top:0; color:#17a2b8;">Memory Buffer</h3>
                    <textarea class="textarea-memory mb-3" style="color:#9ED2C6;">{{ memory_buffer|safe }}</textarea>
                
                    <hr class="mb-5" style="color:green;">
                    <hr class="mb-3" style="color:yellow;">

                    <!-- Add a button to trigger the display of serialized_histories -->
                    <div class="text-center">
                        <button class="btn btn-success submit mb-3" id="showHistoriesButton" onclick="toggleHistories()">
                            Show Conversations
                        </button>
                    </div>

                    <!-- Add a div to contain the serialized histories -->
                    <div id="historiesContainer" class="mb-3" style="display: none;">
                        {% for conversation in serialized_memory_load %}
                        <!--{{ conversation|tojson(indent=4)|safe }}-->
                        <textarea class="form-control mb-3" id="userInput" name="text_writing" style="color:#AEFAFC !important;">
                            "conversation_id": "{{ conversation.id }}"
                            "{{ conversation.user_name }}": "{{ conversation.user_message }}"
                            "·SìįSí·Dbt·": "{{ conversation.llm_response }}"
                            "conversation_summary": "{{ conversation.conversations_summary }}"
                            "created_at": "{{ conversation.created_at }}"
                        </textarea>
                        {% endfor %}
                    </div>

                    <hr class="mb-5" style="color:yellow;">
                    <hr class="mb-3" style="color:red;">
                
                    <div class="text-center">
                        <button type="button" class="btn btn-outline back-home mb-3">
                            <a href="{{ url_for('conversation_interface.conversation_interface') }}" class="">Back Home -¡!¡-</a>
                        </button>
                    </div>
                
                    <hr class="mb-5" style="color:red;">
                </div>

            {% endif %}
                
        </div>

    </div>

    <script src="{{ url_for('static', filename='js/toggle-histories.js') }}"></script>

{% endautoescape %}
{% endblock %}

{% block footer %} {% endblock %}
