{% extends 'header.html' %}

{% import "bootstrap/wtf.html" as wtf %}

{% block title %} Welcome to {% endblock %}

{% block head %}
    {{ super() }}
    <link rel="shortcut icon" type="image/x-icon" href="{{ url_for('static', filename='assets/images/favicon1.ico') }}">
    {% include 'bootstrap/base.html' %}
{% endblock %}

{% block content1 %}
    <div class="container-fluid">
        <div class="p-1 rounded-3 jumbotron bg-dark text-light">
            <div class="py-1">
                <h1 class="">Database Conversations ¡!¡</h1>
            </div>
        </div>
    </div>
{% endblock %}

{% block content %}
{% autoescape true %}

<div class="conversations content container">

    <!--<div class="d-flex justify-content-end">-->
    <div class="d-flex justify-content-center mb-5">
        <button class="btn btn-outline-info submit scroll-down"
                onclick="scrollDown()" id="scrollDownButton" style="position:fixed">
            ⇩
        </button>
    </div>

    <hr class="crimson mb-3">

    <!-- Add a button to trigger the display of users -->
    <button class="btn btn-info submit mb-3" id="showUsersButton" onclick="toggleUsers()">
        -¡!¡- Show Database User -¡!¡-
    </button>

    <!-- Add a div to contain the users -->
    <div id="usersContainer" class="mb-3" style="display: none;">
    <h6>Users</h6>
    <ul>
        {% for user in users %}
        <pre class="align-left" id="messages">-User ID: {{ user.id }}<br>- Username: {{ user.name }}<br>- User email: {{ user.email }}<br>- Date: {{ user.created_at}}
        </pre>
        {% endfor %}
    </ul>
    </div>

    <hr class="crimson mb-5">
    <hr class="green mb-3">

    <!-- Add a button to trigger the display of serialized_histories -->
    <button class="btn btn-success submit mb-3" id="showHistoriesButton" onclick="toggleHistories()">
        -¡!¡- Show Database Memory -¡!¡-
    </button>

    <!-- Add a div to contain the serialized histories -->
    <div id="historiesContainer" style="display: none;">

        {% for conversation in serialized_conversations %}
            <textarea class="form-control align-left mb-3" id="userInput" name="text_writing" style="color:#17a2b8;">
                "Conversation ID": "{{ conversation.id }}"
                "{{ conversation.user_name }}": "{{ conversation.user_message }}"
                "·SìįSí·Dbt·": "{{ conversation.llm_response }}"
                "Conversation Summary": "{{ conversation.conversations_summary }}"
                "Created At": "{{ conversation.created_at }}"
            </textarea>
        {% endfor %}

    </div>

    <hr class="green mb-5">
    <hr class="gold mb-3">

    <!-- Add a button to trigger the display of serialized_histories -->
    <button class="btn btn-warning submit mb-3" id="showHistoriesJsonButton" onclick="toggleHistoriesJson()">
        -¡!¡- Show Database Memory json -¡!¡-
    </button>

    <!-- Add a div to contain the serialized histories -->
    <div id="historiesContainerJson" class="mb-3" style="display: none;">
        {% for conversation in serialized_conversations %}
            <pre class="align-left">
                {{ conversation|tojson(indent=4)|safe }}
            </pre>
        {% endfor %}
    </div>

    <hr class="gold mb-5">
    <hr class="crimson mb-3">

    <!-- Add a button to trigger the display of serialized_histories -->
    <button class="btn btn-primary submit mb-3" id="showThemesButton" onclick="toggleThemes()">
        -¡!¡- Show Database Themes -¡!¡-
    </button>

    <!-- Add a div to contain the serialized histories -->
    <div id="themesContainer" class="mb-3" style="display: none;">
    <h6>Themes</h6>
    <ul>
        {% for theme in themes %}
        <pre id="themes">Theme ID: {{ theme.id }} - Name: {{ theme.theme_name }}</pre>
        {% endfor %}
    </ul>
    </div>

    <hr class="crimson mb-3">

    <!-- Add a button to trigger the display of serialized_histories -->
    <button class="btn btn-info submit mb-3" id="showMessagesButton" onclick="toggleMessages()">
        -¡!¡- Show Database Messages -¡!¡-
    </button>

    <!-- Add a div to contain the serialized histories -->
    <div id="messagesContainer" class="mb-3" style="display: none;">
    <h6>Messages</h6>
    <ul>
        {% for message in messages %}
        <pre class="align-left" id="messages">-Theme Name's: {{ message.theme }}<br>-Message ID: {{ message.id }}<br>- User: {{ message.user }}<br>- Message: {{ message.value }}<br>- Date: {{ message.date}}
        </pre>
        {% endfor %}
    </ul>
    </div>

    <hr class="crimson mb-5">
    <hr class="green mb-3">

    <!-- Add a button to trigger the display of serialized_histories -->
    <button class="btn btn-success submit mb-3" id="showHistoriesTestButton" onclick="toggleTestHistories()">
        -¡!¡- Show Database MemoryTest -¡!¡-
    </button>

    <!-- Add a div to contain the serialized histories -->
    <div id="historiesTestContainer" style="display: none;">
    <h6>MemoryTest</h6>

        {% for conversation in serialized_memory_tests %}
            <textarea class="form-control align-left mb-3" id="userInput" name="text_writing" style="color:#17a2b8;">
                "Conversation ID": "{{ conversation.id }}"
                "User Message": "{{ conversation.user_message }}"
                "·SìįSí·Dbt·": "{{ conversation.llm_response }}"
                "conversation_summary": "{{ conversation.conversations_summary }}"
                "created_at": "{{ conversation.created_at }}"
            </textarea>
        {% endfor %}

    </div>

    <hr class="green mb-5">
    <hr class="gold mb-3">

    <div class="row">
        <div class="col-lg-8 col-md-10 mx-auto mb-3">
            <form method="POST" action="{{ url_for('conversation_function.delete_data') }}">

                {% with messages = get_flashed_messages() %}
                    {% if messages %}
                        {% for message in messages %}
                            <h5 class="alert-warning">{{ message }}</h5>
                        {% endfor %}
                    {% endif %}
                {% endwith %}
                
                <!-- Include CSRF token -->
                {{ database_form.csrf_token }}

                <span class="align-left">{{ wtf.form_field(database_form.database_name, autofocus=true) }}</span>
                <span class="align-left">{{ wtf.form_field(database_form.data_id) }}</span>
                {{ wtf.form_field(database_form.submit, class="submit nav-link btn btn-danger") }}
            </form>
        </div>
    </div>
    
    <hr class="gold mb-5">
    <hr class="crimson mb-3">

    <button type="button" class="btn back-home mb-3">
        <a href="{{ url_for('conversation_interface.conversation_interface') }}" class="nav-link">-¡!¡- Back Home -¡!¡-</a>
    </button>

    <hr class="crimson mb-5">

</div>

<script src="{{ url_for('static', filename='js/database.js') }}" defer></script>

{% endautoescape %}
{% endblock %}
